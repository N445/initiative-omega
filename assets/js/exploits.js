import './../styles/exploits.scss';

let jQueryBridget = require('jquery-bridget');
let Isotope       = require('isotope-layout');
import {Fancybox} from "@fancyapps/ui";

require('isotope-cells-by-row')
// make Isotope a jQuery plugin
jQueryBridget('isotope', Isotope, $);

jQuery.expr[':'].icontains = function (a, i, m) {
    return jQuery(a).text().toUpperCase()
        .indexOf(m[3].toUpperCase()) >= 0;
};

let $grid;
$(window).on('load', function () {
    $grid = $('.exploits').isotope({
        percentPosition: true,
        masonry: {
            columnWidth: '.grid-sizer',
            gutter: 10,
        },
    });
});


$.each($('[data-filters-search]'), function (key, element) {
    filterFilters($(element));
});

$('[data-filters-search]').on('change keyup', function () {
    filterFilters($(this));
})

// cool name
function filterFilters(element) {
    let type            = $(element).attr('data-filters-search');
    let value           = $(element).val();
    let filtersElements = $(`.filters.${type}`);

    filtersElements.find(':not(:icontains(' + value + '))').parents('[data-filter]').hide();
    filtersElements.find(':icontains(' + value + ')').parents('[data-filter]').show();
}

// filter items on button click
let filterValues = [];
$('button[data-filter-all]').on('click', function () {
    $(this).blur();
    runAllFilter();
});

$('button[data-filter]').on('click', function () {
    $(this).blur();
    $(this).toggleClass('active');

    if($('button[data-filter].active').length === 0) {
        runAllFilter();
        return false;
    }

    $('button[data-filter-all]').removeClass('active');

    let value = $(this).attr('data-filter');
    if($(this).hasClass('active')) {
        filterValues.push(value);
    } else {
        filterValues.splice(filterValues.indexOf(value), 1)
    }

    $grid.isotope({filter: filterValues});
});


function runAllFilter() {
    $('button[data-filter-all]').addClass('active');
    $('button[data-filter]').removeClass('active');
    $grid.isotope({filter: '*'});
    filterValues = [];
}
